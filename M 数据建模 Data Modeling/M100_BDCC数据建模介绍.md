# BDCC数据建模介绍



* <font size=5>[1 数据建模综述](#1)</font>
    * <font size=4>[1.1 什么是数据模型](#1.1)</font>
    * <font size=4>[1.2 为什么需要数据模型](#1.2)</font>
* <font size=5>[2 数据模型的分类](#2)</font>
* <font size=5>[3 数据模型在数据平台中的层次位置](#3)</font>
* <font size=5>[4 数据模型的典型应用场景](#4)</font>
* <font size=5>[5 BDCC的数据建模实践](#5)</font>

<h2 id="1">1. 数据建模综述</h2>
    本文将介绍数据建模的基本思想和原则，BDCC数据模型的设计理念与方法，以及BDCC平台的数据建模实践。

<h3 id="1.1">1.1 什么是数据模型</h3>
——万物皆可建模

所谓数据模型，是抽象描述现实世界的一种方法，是通过抽象的实体及实体之间联系的形式，来表示现实世界中事务的相互关系的一种映射。通过对实体的各项属性的定义和描述，来形容一个现实的实体；通过对实体和实体之间关系的定义和描述，来表达实际的业务中具体的业务关系。

    我们观察一个东西，总是要从它的外观、大小、颜色等等入手，这都是物体的“属性”，
    将这些属性用数字、文字等方式记录下来，就成为了这个物体的“数据模型”。
    我们要描述一个事情，比如一个统计结果，更是需要用数字、标签等等，这些信息放到一起，也是一个“数据模型”。
    我们尽可能的用数字、文字来记录和描述物体、事件，并用这些数字、文字来发现事情的变化和规律；
    记录得越全面、越准确，描述得也就越贴近真实，对它的研究才越有意义。
    我们会把它的变化规律总结成为“公式”，当这些公式足够的真实、准确，
    我们甚至可以凭借公式的推演来模拟事情实际的变化发展，这就是“数字仿真”。
<h3 id="1.2">1.2 为什么需要数据模型</h3>
随着业务的发展，更多的公司会关注数据所带来的价值，于是开始采集更大量的数据，数据量及涉及采集范围也与日剧增，如何将这些数据进行有序、有结构的分类组织和存储是企业面临的一个挑战。

    如果把数据看作图书馆里的书，我们更希望看到在书架上分门别类地放置，以便于我们更方便的找到我们所需资料。
BDCC所面对的电子制造行业，数据建模无处不在。大家数字化都做了很多，各种IT系统也架设了不少，但有些似乎并不好用。是这些数据建模做错了么？其实未必，更可能是选错了类型。

<h2 id="2">2. 数据模型的分类</h2>

<h3 id="2.1">2.1 面向流程的建模</h3>

    我们的作业系统，比如MES、WMS等，都是面向流程的，因为大家关注的就是业务流程的推进，让“事情可以做完”。这类模型中要具备的核心信息是流程步骤，以及执行这个步骤的时间戳、状态值、执行者等。随着业务流程的推进，这些信息都会不停的变化，直到业务流程完全结束。

<h3 id="2.2">2.2 面向对象的建模</h3>

    制造过程中的产品、原材料、设备治具等等，就是一个一个的对象，我们所描述的是这些对象的属性。
    
    对于产品来说，核心的信息是SN、PN这些标识信息，属性则包括产品分类、部件组成、投产/完成时间等等。对于治具，就是治具编号、型号、参数配置和部署位置等。这些信息也会有变化，但我们所关注的通常都是它的“结果”，换言之，是它最后的一个“版本”。

    还有一些对象，比如订单信息、BOM、客户信息等，相比起制造过程的各项数据，其变化是很少的。它们并不参与业务流程的推进，而是提供各项基础信息。

<h3 id="2.3">2.3 面向指标的建模</h3>

    数字化的管理就是基于各项指标，因此面向指标的建模也是一大类，虽然并不是业务流程所产生的一手数据，但对于管理来说，其用处往往更大。

    指标模型的典型结构，就是其数据项是分成维度、度量两大类的。我们把各种面向对象的数据进行统计，按照所需的“特征”进行分组，计算出数量、合计、最大/最小/平均等数值，这些特征就是维度，数值则是度量。
    - 维度可能有字符型、数字型；而度量一定是数字。
    - 作为维度的信息，其取值是离散的，范围往往是可穷举的，即便是数字型也是不分大小的——或者大小只在排序时才有意义；而度量的取值是连续的，也就不可穷举，既然一定是数字，大小就一定有意义，因为我们用的就是它的大小的比较。
    - 时间信息比较特殊，它本来是不会成为维度或度量的，因为它既无法穷举，其加总、平均也是没有意义的。我们会将时间信息截取，比如到日、月或小时，再来进行daily、weekly、hourly的统计，它就成为了维度；当然，我们也可以计算两个时刻的差值，成为“持续时间”，尤其在效率相关的指标里，这是一个重要的度量信息。

[问题] 

1.Log记录属于哪一类数据模型？

2.时间戳在指标类数据模型中会发生怎样的变化？

<h2 id="3">3. 数据模型在数据平台中的层次位置</h2>

<h3 id="3.1">3.1 面向流程的数据模型</h3>

面向流程的数据模型，用于业务流程的推进。这也就是基本的“数字化”过程。这样的数据模型都存在于各业务系统中。这类数据模型甚至并不一定是结构化的表，只有业务系统在管理其内容。由于是面向各个业务流程步骤的，其数据通常是分散的，对当前步骤来说“够用就好”，也因此，这数据中可能会存在重复、不规范等现象。

<h3 id="3.2">3.2 面向对象的数据模型</h3>

这类模型既包含了产品、原材料、设备治具诸般对象的基本信息，也记录了当前的状态，这其实是从流程数据整理而来。通常，这就已经离开了原业务系统，而进入了专门的数据平台。在数据平台的层次定义中，这个部分被称为“ODS（Operational Data Store）层”；相应的，业务系统的数据被称为“Stage层”。从业务系统到数据平台，一个重要的工作就是数据的清洗，识别出不符合规范的脏数据，并将各个对象的信息栏位对齐，也就是非结构数据的结构化整理。这个工作就是“ETL”

  要描述一个对象，比如我们的产品，就涉及到方方面面的内容，而在业务系统中这些数据是分散的——比如SN来自Label系统，PN/Model等来自BOM，当前状态、投产时间来自MES系统，等等。当我们要对“产品”建模，需要将这些信息聚合到一起，就要将这些分散的信息提取过来，放入一个完整的数据模型中，这个工作伴随着ETL过程完成，这就进入到数据平台的更高层次，也就是“DW（Data Warehouse）层”，也有人称之为“Integration层”。可以想象，既然数据来自各个业务系统，如果当初的系统设计并不是在一个统一框架下，那么数据聚合到一起的时候就必然面临着匹配性的问题，这也就是所谓的“数据孤岛”问题，这类数据模型整理工作的最大考验也就在于此。

  因此，Integration层数据模型的建立，必然伴随着数据治理的推进，尤其是数据一致性和标准化的改善。我们面临到这方面的问题，比如Code的不一致，各业务系统针对同一个业务概念有不同的Code定义，就导致数据关联的时候顾此失彼；再比如时间信息或Transaction信息，是很多流程相关数据的关键key，但由于业务系统记录的是自己所关心的key，就导致数据放到一起时缺少了一个“步调一致”的key。

<h3 id="3.3">3.3 面向指标的数据模型</h3>

这类模型基本上都是在面向对象的数据之上进行统计计算得来的，在数据平台中也是更高的层次，我们称之为“DW（Data Warehouse）层”——也不妨将其与Integration层合在一起统称为DW层。

  这个层次更多的是从管理视角出发，确定一系列的管理指标，并将其具象化。生产管理中的两大抓手——品质和效率，也就成了我们指标模型中的两大核心：Yield Rate(FPY/VPY)和Efficiency（AE/PE/OEE）。既然是对对象数据的统计计算，指标数据都是聚合数据，其体量会小于业务对象数据；但实际使用中我们会需要各种不同的维度、不同的粒度的指标管理，因此同样的指标又会衍生出不同维度和粒度的变种，这又使得指标数据模型的数量变多起来。从数据存储的效率来说，我们可以利用视图来呈现不同的维度和粒度；但从效率考虑，我们也可以选择创建实体表来装入数据。

<h3 id="3.4">3.4 Data Mart</h3>

在数据平台中，DW层之上还会有一个层次叫DM（Data Mart）。同样的对象数据、指标数据，在不同的应用场合、面向不同使用者时会有不同的需求和不同的呈现方式，比如有的就要按行呈现指标而有的则是要按列呈现，有的又要把不同的对象数据乃至指标数据组合在一起。这更类似于“查询”功能，从数据平台中取出数据按所需格式进行组合输出，同样出于效率和管理考虑，我们会将这些查询结果预先整理出来存放在实体表中。这类数据表的通用性往往不会太好，而各表之间内容的重复性也会挺高，就像超市货架上的商品，同一种类不同品牌，甚至同一个品牌只是不同规则的摆了满满一个货架，方便顾客按需选择。这也就是Data Mart这个名字的由来。

[问题]

1.ODS层、DW层和DM层，这样划分的目的和用途是什么？

2.我们所说的“星型模型”、“雪花型模型”应该是在那一层出现的？

<h2 id="4">4. 数据模型的典型应用场景</h2>
 
<h3 id="4.1">4.1 业务系统——面向流程的数据模型</h3>

  这类数据因为是来自业务系统，因而也基本上都用于业务系统本身的操作，或是业务资料的检索查询与维护；呈现方式通常都是表格。在使用上，通常都会伴随着修改更新，其结果也都会回到业务系统中。

<h3 id="4.2">4.2 信息检索——面向对象的数据模型</h3>

  此时的数据已经离开了业务系统，作为“结果数据”或“固有属性”保存至数据平台，其检索呈现可以不算是业务系统的本身职责。这类数据有两大典型应用场景：

  - 信息检索，即针对产品、设备、原材料登的查询检索，通常输入一些查询条件如产品序号、型号、时间范围等等，得到相应的明细信息。和业务系统中的查询不同的是，它只负责呈现这些信息的“结果”，并不负责“更新”，这些数据即使有变化，也是来自业务系统数据变化的同步更新。而相应的好处是，它可以呈现更全面的信息，按使用者的需要进行更全面的组合——当然，这个使用者也很可能并不是业务系统的操作人员。比如产品履历查询，根据输入的产品序列号，查询出产品的基本配置、产测结果、不良维修信息、出货信息等等。

  - 对某一方面的信息做阶段性查询检索做内容盘点。呈现的信息可能与业务系统中的数据差别并不大，但因为这是数据平台做了清洗整理的数据，并且可以长期保存，因而查询范围更大，业务系统往往只保留进行中的数据，历史数据还是要从数据平台来。同时，因为是按对象主题做了关联梳理，其检索查询也可以更为简练直接，提高效率。比如产品测试数据的检索，可以按型号、线别、时段乃至测试人等多样的条件来做大范围的查询。

<h3 id="4.3">4.3 监控管理——面向指标的数据模型</h3>

  指标是用于管理的，因此面向指标的数据的典型应用场景就是各类监控看板、报表，等等。通过指标，我们可以观察到生产的良率、效率现况和发展趋势，从而采取管理措施。而由于指标模型是统计得来，让我们能够从宏观去看趋势，同时也损失了具体的细节，因此当我们要做进一步的问题分析时，还要结合对象模型所输出的明细数据来进行。

  有一些管理看板，它所呈现的统计数字背后基本上就是对原始数据的简单汇总，比如“当前完成数”、“执行失败次数”、“出勤人数”等，很多时候我们就在呈现时直接统计计算了。但从设计过程中看，依然是秉持着“指标模型”的思路在其中的；而且，如果这些计算在更多的场合被反复使用，那也要把它固化下来成为实体模型表。

[问题]

1.假设有一块设备温度监控看板，它的数据是来自对象数据模型还是统计数据模型？或者二者兼有？

<h2 id="5">5. BDCC的数据建模实践</h2>
 
<h3 id="5.1">5.1 面向对象的数据模型</h3>

  - 针对不同的产品层次（L6、L10/L11），我们分别建立了对产品基本信息进行汇总描述的数据模型，综合产品的型号信息、配置信息、订单信息以及状态信息。
  - 分别建立产品的制程模型，用以记录产品的生产履历和测试履历，这是良率和效率计算的核心材料
  - 产品测试数据模型，将产品测试过程中产生的原始数据进行梳理，提取出格式化的核心内容，用于产品品质相关的信息检索和分析
  - 产品的不良信息，记录了每一次发生的测试不良的现象、原因、维修措施、维修结果等，这是进行品质分析的基础
  - 产品的出货信息，记录产品的订单信息包括单号、出货方、出货地等等，以及出货时间、包材、栈板信息等等；此外，还扩展出客户反馈的信息等
  - 产品的返修信息，记录了每一次发生的线上返修、客户退回返修的履历
  - 随着数据平台覆盖面的扩大，还有更多业务领域的数据模型加入进来

<h3 id="5.2">5.2 面向指标的数据模型</h3>

  - 基于产品制程数据模型，我们建立起产品良率指标，在细粒度上建立模型表，更粗粒度的模型则通过视图等方式统计输出。模型表中包括了产品信息的各项维度，满足品质分析中的各方面钻取分析需求。
  - 基于产品制程数据模型建立起产品效率指标，将计划数据、产出数据及损失数据都统计成各项指标，在细粒度上建立模型表。
  - 产品返修量的数据模型，以产品分类、不良分类、责任分类等维度来进行统计。

<h3 id="5.3">5.3 面向使用者的数据输出</h3>

  - 面对越来越多的客户数据服务需求，我们建立了面向客户的Data Mart数据表，它们都来自相同的基础对象，但各自有不同的取舍、不同的结构以及不同的命名。统一的模型基础让我们更有能力注意并管理不同客户的需求差异，提供一致性更高的数据结果。
  - 面对各种监控看板进行数据预处理，保证查询显示的效率。
