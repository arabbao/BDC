<img src="../封面前言和封底%20Cover%20Preface/resource/BDC.png" title="NAME" height="20%" width="20%">

# Big Data Cloud Center Training BDCC培训课程
## 当前课程：C100 BDCC数据收集技术介绍
### 课程版本： V1.0
### 讲师：张兴龙

# 前言 Preface

数据采集作为 Inventec 大数据系统体系的第一环尤为重要。因此 BDC 团队 建立了一套标准的数据采集方案，致力规范、高性能地完成海量数据的采集，并将其传输到大数据平台。

我们将数据采集分为日志采集和数据库数据同步两部分。本章侧重讲解数据从业务系统同步进入数据仓库这个环节，但其适用性并不仅限于此。

## 课程受众

- 数据工程师
- DBA

## 课程目标

- 了解常见的数据同步方式，以及各种方法的适用场景

## 课程在BDCC架构中的映射

![](../封面前言和封底%20Cover%20Preface/resource/BDCC-traning-DC1.png)

# 课程内容

## 数据收集方法介绍

源业务系统的数据类型多种多样，有来自于关系型数据库的结构化数据，如 Oracle、SQL Server、 MySQL 等; 也有来源于非关系型数据库的非结构化数据，如 MongoDB 等了; 还有来源于文件系统的结构化或非结构化数据，如文件存储 NAS，Samba，对象存储 Minio，OSS 等，这类数据通常以文件形式存储。

数据同步需要针对不同的数据类型及业务场景选择不同的同步方式。总的来说，同步方式可以分为三类: 数据库直连同步、数据库日志解析同步、数据文件同步。

### 数据库直连同步

直连同步是指通过 JDBC/ODBC 等统一规范的标准接口来直接访问数据库。

直连同步方式实现容易，但对源系统的性能影响大，当执行大批量数据同步时会降低业务系统的性能。如果业务库采取主备策略，则可以从备库抽取数据，避免对业务系统产生性能影响。

### 数据库日志解析同步

目前，大多数主流数据库都已经实现了使用日志文件进行系统恢复，因为日志文件信息足够丰富，而且数据格式也很稳定，完全可以通过解析日志文件获取发生变更的数据，从而满足增量数据同步的需求。

以 Oracle 为例，可以通过源系统的进程，读取归档日志文件用以收集变化的数据信息，并判断日志中的变更是否属于被收集对象，将其解析后传送到消息总线供下游消费。这种读操作是在操作系统层面完成的，不需要通过数据库，因此也不会给源系统带来性能影响。下游系统可通过消费此数据完成数据的导入，从而实现数据从源端到目标端的同步。

数据库日志解析同步方式实现了实时与准实时同步的能力，延迟可控制在秒级，并且对业务系统的性能影响也比较小，目前广泛应用于从业务系统到数仓系统的增量数据同步应用中。

需要明确一点，由于解析数据库日志可以获得所有的数据记录的变更（增、删、改），落地到目标表时我们需要根据主键去重按照日志时间倒排序获取最后状态的变化情况。对于删除数据这种变更情况，针对不同业务场景可以采用一些不同的落地手法。

通过数据库日志解析进行同步的方式性能好，效率高，对业务系统的影响较小。但它也存在一些问题:
- 数据延迟。例如，业务系统做批量补录可能会使数据更新量超出系统处理峰值，导致数据延迟
- 投入较大。采用数据库日志解析同步的方式投入较大，需要在源端和目标端之间部署一些服务来实时抽取数据
- 数据漂移和遗漏。

### 数据文件同步

数据文件同步通过约定好的文件编码，格式，大小等，直接从源系统生成的数据文件，存放至专门的文件服务器，如 FTP 服务器，然后加载到目标数据库中。当数据源包含多个异构的数据库(如 MySQL、Oracle、SQL Server等)时，用这种方式比较简单、实用。另外，针对日志类数据，通常是以文本文件形式存在的，也适合使用数据文件同步方式。

由于通过文件服务器上传、下载可能会造成丢包或错误，为了确保数据文件同步的完整性，通常除了上传数据文件本身以外，还会上传一个校验文件，该校验文件记录了数据文件的数据量以及文件大小等校验信息，以供下游目标系统验证数据同步的正确性。

另外，在从源端系统生成数据文件的过程中，可以增加压缩和加密功能，传输到目标系统后，再对数据进行解压缩和解密，这样可以大大提高文件的传输效率和安全性。

# 课后问题

1. 常见的数据同步有哪几种方式？
2. 数据库实时同步有哪些限制条件？
3. 数据库定时同步可能遇到什么问题？

# 讲师邮件地址

Zhang.Xing-Long@inventec.com


